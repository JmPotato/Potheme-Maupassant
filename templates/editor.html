{% extends 'admin-layout.html' %}

{% block title %} | Editor{% end %}

{% block head %}
<script>
function AutoSave(it) {
    var _value = it.value;
    if (_value) {

        var expDays = 30;
        var exp = new Date();
        exp.setTime( exp.getTime() + (expDays * 86400000) );
        var expires='; expires=' + exp.toGMTString();

        document.cookie = "AutoSaveContent=" + escape (_value) + expires;
    }
}

function AutoLoad(it) {
    var _value = it.value;
    if (!_value) {
        var _LastContent = GetCookie('AutoSaveContent');

        if (!_LastContent) return;

        if (confirm("Load Last AutoSave Content?")) {
            it.value = _LastContent;
            return true;
        }
    }
}

function getCookieVal (offset) {
    var endstr=document.cookie.indexOf (";",offset);
    if (endstr==-1) endstr=document.cookie.length;
    return unescape(document.cookie.substring(offset, endstr));
}

function GetCookie (name){
    var arg=name+"=";
    var alen=arg.length;
    var clen=document.cookie.length;
    var i = 0;
    while (i<clen){
        var j=i+alen;
        if (document.cookie.substring(i,j)==arg) return getCookieVal (j);
        i = document.cookie.indexOf(" ",i)+1;
        if (i==0) break;
    }
    return null;
}

function DeleteCookie (name) {
    var exp=new Date();
    exp.setTime (exp.getTime()-1);
    var cval=GetCookie (name);
    document.cookie=name+"="+cval+";expires="+exp.toGMTString();
}
</script>
{% end %}

{% block menu %}
    <a href="/admin">
        <i class="fa fa-tachometer"> Panel</i></a>
    <a class="{% if not is_page %}current{% end %}" href="/admin/edit/new/article">
        <i class="fa fa-pencil"> Write</i></a>
    <a class="{% if is_page %}current{% end %}" href="/admin/edit/new/page">
        <i class="fa fa-file"> Creat</i></a>
    <a href="/admin/dropbox">
        <i class="fa fa-dropbox"> Backup</i></a>
    <a href="{{ handler.settings['blog_url'] }}">
        <i class="fa fa-sign-out"> Leave</i></a>
{% end %}

{% block panel %}
<div class="post">
    <h1 class="post-title" style="text-align:center;">Editor</h1>
    <hr>
    <div id="article" class="post-content">
    {% if is_page %}
        <form class="login-form" action="#" method="post" id="page_editor">
            <div class="input">
                <label for="title">Title</label>
                {% if new %}
                <input id="title" name="title" type="text" style="width:95%;">
                {% else %}
                <input id="title" name="title" type="text" style="width:95%;" value="{{ content.title }}">
                {% end %}
            </div>
            <div class="input">
                <label for="content">Content</label>
                {% if new %}
                <textarea style="width:95%;" rows="30" id="content" name="content" onkeyup="AutoSave(this);" onchange="AutoSave(this);" ondblclick="AutoLoad(this);"></textarea>
                {% else %}
                <textarea style="width:95%;" rows="30" id="content" name="content" onkeyup="AutoSave(this);" onchange="AutoSave(this);" ondblclick="AutoLoad(this);">{{ content.content }}</textarea>
                {% end %}
                <p style="text-align:center;">Tip: Double click box to load last autosave content</p>
            <div id="submit">
                <button class="login" type="submit">Post</button>
            </div>
        </form>
        {% else %}
        <form class="login-form" action="#" method="post" id="article_editor">
            <div class="input">
                <label for="title">Title</label>
                {% if new %}
                <input id="title" name="title" type="text" style="width:95%;">
                {% else %}
                <input id="title" name="title" type="text" style="width:95%;" value="{{ article.title }}">
                {% end %}
            </div>
            <div class="input">
                <label for="tag">Tag</label>
                {% if new %}
                <input id="tag" name="tag" type="text" style="width:95%;">
                {% else %}
                <input id="tag" name="tag" type="text" style="width:95%;" value="{{ article.tag }}">
                {% end %}
            </div>
            <div class="input">
                <label for="content">Content</label>
                {% if new %}
                <textarea style="width:95%;" rows="30" id="content" name="content" onkeyup="AutoSave(this);"  onchange="AutoSave(this);"ondblclick="AutoLoad(this);"></textarea>
                {% else %}
                <textarea style="width:95%;" rows="30" id="content" name="content" onkeyup="AutoSave(this);"  onchange="AutoSave(this);"ondblclick="AutoLoad(this);">{{ article.content }}</textarea>
                {% end %}
                <p style="text-align:center;">Tip: Double click box to load last autosave content</p>
            <div id="submit" style="margin:auto">
                <button class="login" type="submit">Post</button>
            </div>
        </form>
        {% end %}
    </article>
</div>
{% end %}